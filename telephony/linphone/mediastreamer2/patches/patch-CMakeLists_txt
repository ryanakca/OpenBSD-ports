fix dlopen detection so that loading plugins work

Index: CMakeLists.txt
--- CMakeLists.txt.orig
+++ CMakeLists.txt
@@ -105,6 +105,7 @@ cmake_dependent_option(ENABLE_QSA "Enable QSA (QNX Sou
 cmake_dependent_option(ENABLE_OSS "Enable OSS support." NO "ENABLE_SOUND;LINUX_OR_BSD" NO)
 cmake_dependent_option(ENABLE_PORTAUDIO "Enable portaudio native support." NO "ENABLE_SOUND" NO)
 cmake_dependent_option(ENABLE_PULSEAUDIO "Enable pulseaudio support." YES "ENABLE_SOUND" NO)
+cmake_dependent_option(ENABLE_SNDIO "Enable sndio support." YES "ENABLE_SOUND" NO)
 option(ENABLE_G726 "Build mediastreamer2 with the G726 codec." NO)
 option(ENABLE_GSM "Build mediastreamer2 with the GSM codec." YES)
 option(ENABLE_BV16 "Build mediastreamer2 with the BV16 codec." YES)
@@ -173,7 +174,7 @@ if(ENABLE_OSS)
 	endif()
 endif()
 
-check_library_exists("dl" "dlopen" "" HAVE_DLOPEN)
+check_library_exists("c" "dlopen" "" HAVE_DLOPEN)
 
 include(TestBigEndian)
 test_big_endian(WORDS_BIGENDIAN)
@@ -246,6 +247,12 @@ endif()
 if(ENABLE_PORTAUDIO)
 	find_package(PortAudio REQUIRED)
 endif()
+if(ENABLE_SNDIO)
+	find_library(SNDIO NAMES sndio)
+	if (SNDIO)
+		set(SNDIO_FOUND ON)
+	endif()
+endif()
 if(ENABLE_PULSEAUDIO)
 	find_package(PulseAudio)
 	if(NOT PULSEAUDIO_FOUND)
@@ -366,7 +373,7 @@ if(ENABLE_QNX)
 	endif()
 endif()
 
-if(ENABLE_SOUND AND NOT(WIN32 OR ENABLE_ALSA OR ENABLE_ARTSC OR ENABLE_MACSND OR ENABLE_MACAQSND OR ENABLE_OSS OR ENABLE_PORTAUDIO OR ENABLE_PULSEAUDIO OR ENABLE_QSA OR ENABLE_ANDROIDSND))
+if(ENABLE_SOUND AND NOT(WIN32 OR ENABLE_ALSA OR ENABLE_ARTSC OR ENABLE_MACSND OR ENABLE_MACAQSND OR ENABLE_OSS OR ENABLE_PORTAUDIO OR ENABLE_PULSEAUDIO OR ENABLE_SNDIO OR ENABLE_QSA OR ENABLE_ANDROIDSND))
 	message(FATAL_ERROR "Could not find a support sound driver API. Use -DENABLE_SOUND=NO if you don't care about having sound.")
 endif()
 
@@ -446,9 +453,6 @@ endif()
 if(ANDROID AND ENABLE_VIDEO)
 	list(APPEND LINK_LIBS EGL GLESv3 android)
 endif()
-if(HAVE_DLOPEN)
-	list(APPEND LINK_LIBS dl)
-endif()
 if(ALSA_FOUND)
 	list(APPEND LINK_LIBS asound)
 	list(APPEND MEDIASTREAMER2_INCLUDE_DIRS ${ALSA_INCLUDE_DIRS})
@@ -468,6 +472,10 @@ if(PULSEAUDIO_FOUND)
 	list(APPEND LINK_LIBS pulse)
   	list(APPEND MEDIASTREAMER2_INCLUDE_DIRS ${PULSEAUDIO_INCLUDE_DIRS})
   	set(__PULSEAUDIO_ENABLED__ 1)
+endif()
+if(SNDIO_FOUND)
+	list(APPEND LINK_LIBS sndio)
+  	set(__SNDIO_ENABLED__ 1)
 endif()
 if(QSA_FOUND)
 	list(APPEND LINK_LIBS ${QSA_LIBRARIES})
